<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache"> 
<META HTTP-EQUIV="Expires" CONTENT="0">
<title>商品详情</title>
<script src="js/jquery1.8.3.js"></script>
<script src="js/rem.js"></script>
<link rel="stylesheet" type="text/css" href="css/style.css" />
<script src="js/browser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="js/base.js" type="application/javascript"></script>
</head>

<body>
<div id="app">
	<div class="maincontent" >
		<div class="product_banner">
			<img src="images/banner2.jpg">
		</div>
		<div class="product_information w710 flex">
			<div class="infor_cont">
				<div class="infor_top flex">
					<div class="infor_left font32 color3 avoidOverflow">{{mainData.title}}</div>
					<div class="infor_right font30" style="text-decoration: line-through ">市场价:¥{{mainData.origin_price}}</div>
				</div>
				<div class="infor_top  flex">
					<div class="infor_left font32 color6">{{mainData.type}}</div>
					<div class="infor_right font30">出售价:¥{{mainData.price}}</div>
				</div>
			</div>
		</div>
		<div class="product_tlt1 w710 flex">
			<div class="tlt_left1 flexCenter">
				<img src="images/detail_icon1.png">
				<span class="font28 color6">商品数量:{{mainData.stock}}</span>
			</div>
			<div class="tlt_left1 flexCenter" style="border-left: solid 1px #e0e0e0;">
				<img src="images/detail_icon2.png">
				<span  class="font28 color6">成交单数:{{mainData.success_number}}</span>
			</div>
		</div>
		<div class="big_title flexRowBetween">
		    <div class="tlt_left"></div>
		    <div class="tlt_center font32 color6">商品介绍</div>
		    <div class="tlt_left"></div>
		</div>
	
		<div id="note" class="w710" class="content ql-editor">
	            <div v-html="mainData.content"></div> 
		</div>
		<div id="note" class="w710">
			<p class="p1">通用门店</p>
			<div class="store flexRowBetween">
				<div class="store_item">门店一</div>
				<div class="store_item">门店一</div>
				<div class="store_item">门店一</div>
				<div class="store_item">门店一</div>
			</div>
		</div>
		<div style="width: 100%;height:1.2rem;"></div>
		<div class="buy w710 flex">
			<div class="buy_left flex">
				<div class="buy_add"  data-type="-" @click="counter" :data-id="mainData.id">-</div>
				<input type="number"  :value="count" style="width:40px;text-align:center" />
				<div class="buy_add"   data-type="+" @click="counter" :data-id="mainData.id">+</div>
			</div>
			<div class="buy_right"><button class="submit_info" @click="addOrder">立即购买</button></div>
		</div>
	</div>
</div>

<script type="text/javascript">
			
			var app = new Vue({
				el: '#app',
				data: function() {
					return {
						mainData:[],
						labelData:[],
						order_id:'',
						totalPrice:'',
						count:1,
					}

				},
				
				created: function () {
					this.getMainData();
				},

				methods:{

					  counter(e){
					    const self = this;
					    console.log(window.base.getDataSet(e,'type').type)
					    if(window.base.getDataSet(e,'type').type=='+'){
					      self.count++;
					    }else if(self.count > '1'){
					      self.count--;
					    }
					    self.countTotalPrice();
					  },

					getMainData() {
						var self = this;
						var postData = {};
						postData.searchItem = {
                            id:window.base.GetRequest().id,
                        }
						var callback = (res)=>{
							self.mainData = res.info.data[0];
						};
						window.base.productGet(postData,callback);
					},	


					  addOrder(){
					    const self = this;
					 	if(!self.order_id){
					      const postData = {
					        token:localStorage.getItem('user_token'),
					        product:[
					          {id:window.base.GetRequest().id,count:self.count}
					        ],
					        pay:{balance:self.totalPrice.toFixed(2)},
					        type:1
					      };
					      const callback = (res)=>{
					        self.order_id = res.info.id;
					        self.pay(self.order_id);     
					      };
					      window.base.addOrder(postData,callback);
					    }else{
					      self.pay(self.order_id)
					    }   
					  },



  

					  pay(order_id){
					    const self = this;
					    const postData = {
					      token:localStorage.getItem('user_token'),
					      searchItem:{
					        id:order_id,
					      },
					      balance:self.totalPrice.toFixed(2),
					      wxPayStatus:0
					    };
					    
					    const callback = (res)=>{
					      
					      if(res.solely_code==100000){
					        alert('ok')
					         
					       
					      }else{
					        alert(res.msg)
					      };
					    };
					    window.base.pay(postData,callback);
					  },


					


					  countTotalPrice(){  
					    const self = this;
					    var totalPrice = 0;
					    totalPrice += self.count*parseFloat(self.mainData.price);
					    self.totalPrice = totalPrice;
					    console.log(self.totalPric)
					  },

				},


			});
			
		</script>
</body>
</html>
